{% extends 'base.html' %}
{% block content %}
<form method="post" class="card p-3 mb-4">
  {% csrf_token %}
  <textarea name="content" rows="3" class="w-full rounded-xl border p-3" placeholder="What's happening?"></textarea>
  <div class="mt-2 flex justify-end"><button class="btn-primary">Post</button></div>
</form>

{% for post in posts %}
  <div class="card post-card mb-4 p-3">
    <a class="stretched-link" href="{% url 'post_detail' post.id %}"></a>
    <a class="stretched-link" href="{% url 'post_detail' post.id %}"></a>

    <div class="flex items-start justify-between">
      <div>
        <div class="text-sm text-gray-700 font-medium">@{{ post.user.username }}</div>
        <div class="text-xs text-gray-500">{{ post.created_at|timesince }} ago</div>
      </div>

      <div class="flex items-center gap-2">
        <a class="chip" href="{% url 'repost' post.id %}?next={{ request.get_full_path|urlencode }}">Repost</a>
        {% if request.user == post.user %}
          <a data-stop-prop="1" class="hover:opacity-70 inline-flex items-center gap-1" href="{% url 'delete_post' post.id %}?next={{ request.get_full_path|urlencode }}" title="Delete"><i class="fa-regular fa-trash-can"></i></a>
        {% endif %}
      </div>
    </div>

    <div class="mt-2 text-gray-800 whitespace-pre-line">{{ post.content }}</div>

    <div class="mt-3 flex items-center gap-6 text-gray-600 action-row">
      <a class="hover:opacity-70 inline-flex items-center gap-1"
         href="{% url 'like_post' post.id %}?next={{ request.get_full_path|urlencode }}" title="Like">
        <i class="fa-regular fa-heart"></i><span>{{ post.likes.count }}</span>
      </a>
      <a class="hover:opacity-70" href="{% url 'repost' post.id %}?next={{ request.get_full_path|urlencode }}" title="Repost">
        <i class="fa-solid fa-retweet"></i>
      </a>
      <a class="hover:opacity-70 inline-flex items-center gap-1" href="{% url 'post_detail' post.id %}" title="Comments">
        <i class="fa-regular fa-comment"></i><span>{{ post.comments.count }}</span>
      </a>
    </div>
  </div>
{% empty %}
  <p class="text-gray-500">No posts yet.</p>
{% endfor %}
{% endblock %}
