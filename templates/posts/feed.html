{% extends 'base.html' %}
{% block content %}
<div class="bg-white rounded-2xl shadow p-4 mb-4">
  <form method="post" class="space-y-2">
    {% csrf_token %}
    <textarea name="content" rows="3" maxlength="280" placeholder="What’s happening?"
      class="w-full border rounded-xl p-3"></textarea>
    <div class="text-right">
      <button type="submit" class="px-4 py-2 rounded-xl bg-black text-white hover:opacity-90">Post</button>
    </div>
  </form>
</div>

<div class="space-y-3">
  {% for post in posts %}
    <div class="bg-white rounded-2xl shadow p-4">
      <div class="flex items-center gap-2 text-sm text-gray-500">
        <a class="font-semibold text-gray-800 hover:underline" href="/profiles/{{ post.user.username }}/">@{{ post.user.username }}</a>
        <span>•</span>
        <span title="{{ post.created }}">{{ post.created|timesince }} ago</span>
        {% if post.reposted_from %}
          <span class="ml-auto text-xs px-2 py-1 rounded-full bg-gray-100">Repost</span>
        {% endif %}
      </div>

      <p class="mt-2 whitespace-pre-wrap">{{ post.content }}</p>

      <!-- Icon-only actions -->
      <div class="mt-3 flex items-center gap-6 text-xl">
        <a class="hover:opacity-70" href="{% url 'like_post' post.id %}" title="Like">
          {% if request.user in post.likes.all %}
            <i class="fa-solid fa-heart"></i>
          {% else %}
            <i class="fa-regular fa-heart"></i>
          {% endif %}
          <span class="text-sm align-middle ml-1">{{ post.likes.count }}</span>
        </a>

        <a class="hover:opacity-70" href="{% url 'repost' post.id %}" title="Repost">
          <i class="fa-solid fa-retweet"></i>
        </a>

        <button class="hover:opacity-70" type="button" title="Comment"
                onclick="document.getElementById('cform-{{ post.id }}').classList.toggle('hidden')">
          <i class="fa-regular fa-comment"></i>
          <span class="text-sm align-middle ml-1">{{ post.comments.count }}</span>
        </button>
      </div>

      <!-- Comments -->
      <div class="mt-3 space-y-2">
        {% for c in post.comments.all %}
          <div class="text-sm bg-gray-50 rounded-xl p-2">
            <a class="font-semibold hover:underline" href="/profiles/{{ c.user.username }}/">@{{ c.user.username }}</a>
            {{ c.content }}
            <span class="text-gray-400">· {{ c.created|timesince }} ago</span>
          </div>
        {% empty %}
          <p class="text-sm text-gray-500">Be the first to comment.</p>
        {% endfor %}
      </div>

      <!-- Add comment -->
      <form id="cform-{{ post.id }}" action="{% url 'add_comment' post.id %}" method="post" class="hidden mt-3">
        {% csrf_token %}
        <input name="content" maxlength="200" class="w-full border rounded-xl p-2" placeholder="Write a comment…" />
        <div class="text-right mt-2">
          <button class="px-3 py-1 rounded-lg border hover:bg-gray-50">Reply</button>
        </div>
      </form>
    </div>
  {% endfor %}
</div>
{% endblock %}
