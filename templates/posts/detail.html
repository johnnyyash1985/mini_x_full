{% extends 'base.html' %}
{% block content %}
<div class="mx-auto max-w-3xl space-y-4">

  <div class="flex items-center justify-between">
    <button onclick="history.back()" class="text-sm text-gray-600 hover:underline">&larr; Back</button>
  </div>

  <div class="bg-white rounded-2xl shadow p-4">
    <div class="text-sm text-gray-700 font-medium">@{{ post.user.username }}
      <span class="text-gray-400">· {{ post.created_at|timesince }} ago</span>
    </div>
    <div class="mt-2">{{ post.content }}</div>

    <div class="mt-3 flex items-center gap-5 text-gray-600">
      <a class="hover:opacity-70" href="{% url 'like_post' post.id %}?next={{ request.get_full_path|urlencode }}" title="Like">
        <i class="fa-regular fa-heart"></i> <span>{{ post.likes.count }}</span>
      </a>
      <a class="hover:opacity-70" href="{% url 'repost' post.id %}?next={{ request.get_full_path|urlencode }}" title="Repost">
        <i class="fa-solid fa-retweet"></i>
      </a>
      <span class="text-sm text-gray-500"><i class="fa-regular fa-comment"></i> {{ post.comments.count }} comments</span>

      {% if post.user_id == request.user.id %}
        <form class="inline ml-auto" method="post" action="{% url 'delete_post' post.id %}?next={{ request.get_full_path|urlencode }}" data-stop-prop="1">
          {% csrf_token %}
          <button type="submit" title="Delete" class="hover:opacity-70">
            <i class="fa-regular fa-trash-can"></i>
          </button>
        </form>
      {% endif %}
    </div>
  </div>

  <!-- Top-level comments only; replies hidden until you click a comment -->
  <div class="space-y-2">
    {% for c in top_comments %}
      {% include 'posts/_comment_min.html' with comment=c %}
    {% empty %}
      <p class="text-sm text-gray-500">Be the first to comment.</p>
    {% endfor %}
  </div>

  <form action="{% url 'add_comment' post.id %}" method="post" class="bg-white rounded-2xl shadow p-3">
    {% csrf_token %}
    <input name="content" maxlength="200" class="w-full border rounded-xl p-2" placeholder="Write a comment…" />
    <div class="mt-2 flex justify-end">
      <button class="bg-black text-white rounded-xl px-4 py-2">Reply</button>
    </div>
  </form>
</div>
{% endblock %}
